name: Deploy to Dev Repo

on:
    push:
        branches:
            - dev

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout main repo
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0
                  persist-credentials: false # Important: disable this so the bot token doesn't interfere

            - name: Transform to Dev version
              run: |
                  # --- 1. Modifications to manifest.json ---
                  sed -i 's/"domain": "watchman"/"domain": "watchman_dev"/' custom_components/watchman/manifest.json
                  sed -i 's/"name":.*,/"name": "Watchman (DEV)",/' custom_components/watchman/manifest.json

                  # --- 2. Modifications to const.py (ROBUST METHOD) ---
                  # We use regular expressions to ensure replacement works regardless of spacing or quotes:
                  # ^  - start of the line
                  # .* - any characters until the end of the line

                  # Replace DB_FILENAME
                  sed -i 's/^DB_FILENAME = .*/DB_FILENAME = "watchman_dev.db"/' custom_components/watchman/const.py

                  # Replace DOMAIN
                  sed -i 's/^DOMAIN = .*/DOMAIN = "watchman_dev"/' custom_components/watchman/const.py

                  # Replace DOMAIN_DATA
                  sed -i 's/^DOMAIN_DATA = .*/DOMAIN_DATA =
